---
import Avatar from "@/components/Avatar.astro";
import Button from "@/components/Button.astro";
import Tile from "@/components/Tile.astro";
import Title from "@/components/Title.astro";
import TemplatedTable from "@/components/table/TemplatedTable.astro";
import Else from "@/components/tera/Else.astro";
import If from "@/components/tera/If.astro";
import Variable from "@/components/tera/Variable.astro";
import Layout from "@/layouts/Layout.astro";
import { variable } from "@/lib/tera";

const name = variable(
    "profile.display_name | default(value=profile.default_display_name)",
    "Benjamin Crocker"
);

const description = `View ${name}'s profile on WCPC. Participated in ${variable("contests | length")} contests.`;
---

<Layout
    path={`/profile/${variable("profile.id")}`}
    description={description}
    class="flex flex-col gap-4"
    title=`${name}'s Profile`
>
    <Tile class="flex flex-col justify-center gap-6 !p-6 text-center md:flex-row md:text-left">
        <Avatar class="mx-auto my-auto" emailVar="profile.email" name={name} size={150} />
        <div class="my-auto flex flex-col gap-1">
            <Title class="my-auto">{name}</Title>
            <p class="my-auto text-xl">
                Joined on <Variable expression="joined" debugEval="February 9th, 2024" />
            </p>
        </div>
        <span class="hidden grow md:flex"></span>
        <If debugEval={true} expression="is_me">
            <Button
                as="a"
                href="/settings/profile"
                class="mx-auto my-auto h-fit w-fit"
                icon="tabler:pencil"
                size="lg">Edit Your Profile</Button
            >
        </If>
    </Tile>
    <Tile>
        <h2 class="text-2xl">Bio</h2>
        <p class="text-lg">
            <If expression="profile.bio | default(value='No Bio Provided') | trim == ''">
                No Bio Provided
                <Else slot="else">
                    <Variable expression="profile.bio | default(value='No Bio Provided')" />
                </Else>
            </If>
        </p>
    </Tile>
    <Tile>
        <h2 class="text-2xl">Stats</h2>
        <TemplatedTable
            class="w-full"
            emptyText="This user hasn't participated in any contests yet."
            itemLink={{
                action: (id) => `/contests/${id}`
            }}
            listName="contests"
            itemName="contest"
            columns={[
                { name: "name", label: "Contest" },
                { name: "solved", label: "Problems Solved" },
                { name: "total", label: "Total Problems" },
                { name: "rank", label: "Place", placeIndicator: "", centerHeader: true }
            ]}
        />
    </Tile>
</Layout>
